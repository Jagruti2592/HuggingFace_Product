name: Sync to Hugging Face

on:
  push:
    branches:
      - main

  workflow_dispatch:

jobs:
  huggingface_sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      - name: Install Hugging Face Hub
        run: pip install huggingface_hub

      - name: Clone Hugging Face Space repository
        env:
          HF_TOKEN: ${{ secrets.github-sync-token }}
        run: |
         for i in {1..5}; do
          git clone https://huggingface.co/spaces/Jagruti25/sample && break
          echo "Retrying in 10 seconds.."
          sleep 10
          done
          cd sample
          git config user.name "Jagruti25"
          git config user.email "jcchitte@wpi.edu"
          

      - name: Sync GitHub repository to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.github-sync-token }}
        run: |
          cd sample
          rsync -av --exclude=".git" ../ ./
          git add .
          git commit -m "Sync GitHub repo with Hugging Face Space"
          git push origin main
